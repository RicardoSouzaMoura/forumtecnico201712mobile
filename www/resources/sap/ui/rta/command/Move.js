/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2016 SAP SE. All rights reserved
 */
sap.ui.define(['jquery.sap.global','sap/ui/rta/command/FlexCommand','sap/ui/rta/controlAnalyzer/ControlAnalyzerFactory',"sap/ui/fl/changeHandler/MoveElements"],function(q,F,C,M){"use strict";var a=F.extend("sap.ui.rta.command.Move",{metadata:{library:"sap.ui.rta",properties:{movedElements:{type:"array"},target:{type:"object"},source:{type:"object"},changeType:{type:"string",defaultValue:"moveElements"}},associations:{},events:{}}});a.prototype.init=function(){this.setChangeHandler(M);};a.prototype._getSpecificChangeInfo=function(f){var s=f?this.getSource():this.getTarget();var t=f?this.getTarget():this.getSource();var S=s.parent||sap.ui.getCore().byId(s.id);if(s.parent){s.id=s.parent.getId();delete s.parent;}if(t.parent){t.id=t.parent.getId();delete t.parent;}var m={changeType:this.getChangeType(),source:s,target:t,movedElements:[]};this.getMovedElements().forEach(function(b){m.movedElements.push({id:b.id||b.element.getId(),sourceIndex:f?b.sourceIndex:b.targetIndex,targetIndex:f?b.targetIndex:b.sourceIndex});});var c=C.getControlAnalyzerFor(S);if(c){m=c.mapSpecificChangeData("Move",m);}else{q.sap.log.error("No control analyzer found for element.");}return{data:m,sourceParent:S};};a.prototype._getFlexChange=function(f){var p=this.getPreparedChange(f);if(!p){var s=this._getSpecificChangeInfo(f);var c=this._completeChangeContent(s.data);p={change:c,selectorElement:s.sourceParent};this.setPreparedChange(p,f);}return p;};a.prototype._getForwardFlexChange=function(e){return this._getFlexChange(F.FORWARD);};a.prototype._getBackwardFlexChange=function(e){return this._getFlexChange(F.BACKWARD);};a.prototype.serialize=function(){return this._getSpecificChangeInfo(F.FORWARD).data;};return a;},true);
