/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/drawer/Drawer","sap/gantt/misc/Utility","sap/ui/core/Core","sap/ui/core/IconPool","sap/ui/thirdparty/d3"],function(D,U,C,I){"use strict";var S=D.extend("sap.gantt.drawer.SelectionPanel");S.prototype.drawSvg=function(t,d,T,g){if(!d){return;}this._oGanttChartWithTable=g;var e=[];for(var i=0;i<d.length;i++){if(d[i].index&&d[i].index!==0){e.push(d[i]);}}var a=t.selectAll(".sapGanttSelectionPanel");if(a.empty()){a=t.append("g").classed("sapGanttSelectionPanel",true);}if(!a.empty()){var b=$(t.node()).width();this._drawExpandedBackground(a,b,T,e);this._drawExpandedContent(a,b,T,e);}};S.prototype._drawExpandedBackground=function(s,t,T,a){var h=s.selectAll(".sapGanttExpandChartHeaderBG").data(a);h.enter().append("rect").classed("sapGanttExpandChartHeaderBG",true);h.attr("x",function(){return C.getConfiguration().getRTL()?t-T+1:2;}).attr("y",function(d){return d.y;}).attr("height",function(d){return d.rowHeight-1;}).attr("width",T-2);h.exit().remove();var c=s.selectAll(".sapGanttExpandChartCntBG").data(a);c.enter().append("rect").classed("sapGanttExpandChartCntBG",true);c.attr("x",function(){return C.getConfiguration().getRTL()?2:T+1;}).attr("y",function(d){return d.y;}).attr("height",function(d){return d.rowHeight-1;}).attr("width",t-T-3);c.exit().remove();var b=s.selectAll("path.sapGanttExpandChartLine").data(a);b.enter().append("path").classed("sapGanttExpandChartLine",true);b.attr("d",function(d){return"M0 "+(d.y-1)+" H"+(t-1);});b.exit().remove();};S.prototype._drawExpandedContent=function(s,t,T,a){var g=this._getLevelIndentByShape;var c=[];for(var i=0;i<a.length;i++){if(a[i].index===1){var b=[];b.push(a[i]);c.push(b);}}s.selectAll("g").remove();var e=s.selectAll("g").data(c);e.enter().append("g").classed("sapGanttExpandChartContent",true);e.exit().remove();var f=e.selectAll(".sapGanttExpandChartIcon").data(function(d){return d;});f.enter().append(function(d){if(I.isIconURI(d.icon)){return document.createElementNS("http://www.w3.org/2000/svg",'text');}return document.createElementNS("http://www.w3.org/2000/svg",'image');}).classed("sapGanttExpandChartIcon",true).classed("iconFont",function(d){return I.isIconURI(d.icon);}).classed("iconImage",function(d){return!(I.isIconURI(d.icon));});e.selectAll(".iconImage").attr("xlink:href",function(d){return d.icon;}).attr("x",function(d){return C.getConfiguration().getRTL()?t-T-g(d)-17:g(d)+T;}).attr("y",function(d){return d.y+4.25;}).attr("width",16).attr("height",16);e.selectAll(".iconFont").attr("x",function(d){return C.getConfiguration().getRTL()?t-T-g(d):g(d)+T;}).attr("y",function(d){return d.y+19;}).text(function(d){var o=I.getIconInfo(d.icon);if(o){return o.content;}}).attr("font-family",function(d){var o=I.getIconInfo(d.icon);if(o){return o.fontFamily;}}).attr("font-size","16px");f.exit().remove();var h=e.selectAll("sapGanttExpandChartText").data(function(d){return d;});h.enter().append("text").classed("sapGanttExpandChartText",true);h.attr("x",function(d){return C.getConfiguration().getRTL()?t-T-g(d)-26:g(d)+T+27;}).attr("y",function(d){return d.y+16.5;}).attr("font-size",function(d){return"0.75em";}).text(function(d){return d.name;}).attr("text-anchor",(sap.ui.Device.browser.name===sap.ui.Device.browser.BROWSER.INTERNET_EXPLORER||sap.ui.Device.browser.name===sap.ui.Device.browser.EDGE)&&C.getConfiguration().getRTL()?"end":"start");h.exit().remove();var j=this;var k=e.selectAll(".sapGanttExpandChartCloseButton").data(function(d){return d;});k.enter().append("text").classed("sapGanttExpandChartCloseButton",true);k.attr("x",function(d){var p,P=jQuery(this).prev("text");if(P&&P.length>0){var B=P[0].getBoundingClientRect();if(B&&B.width>0){p=B.width;}else{p=P[0].clientWidth;}}if(isNaN(p)||p==null||p==0){p=60;}var l=C.getConfiguration().getRTL()?t-T-g(d)-p-37:g(d)+T+p+35;return l;}).attr("y",function(d){return d.y+19;}).text(function(d){var o=I.getIconInfo("decline",undefined);if(o){return o.content;}}).attr("font-family",function(d){var o=I.getIconInfo("decline",undefined);if(o){return o.fontFamily;}}).attr("font-size","14px").attr("font-weight","bolder").on("click",function(d){var B=j._oGanttChartWithTable._oTT.getBinding("rows");var r=B.getContexts(0,B.getLength());for(var i=0;i<r.length;i++){var o=r[i].getProperty();if(o&&d.id&&o.id===d.id){j._oGanttChartWithTable.handleExpandChartChange(false,[d.chartScheme],[i]);}}});k.select("title").remove();k.insert("title",":first-child").text(function(d){return sap.ui.getCore().getLibraryResourceBundle("sap.gantt").getText("TLTP_CLOSE");});k.exit().remove();};S.prototype._getLevelIndentByShape=function(s){var f=13;var m=17;var i=25;var h=0;if(s&&s.bindingObj&&s.bindingObj._aRowIndexMap&&s.rowIndex&&s.rowIndex<s.bindingObj._aRowIndexMap.length){h=s.bindingObj._aRowIndexMap[s.rowIndex].level;}if(isNaN(h)||h==null){h=0;}return m*h+i+f;};return S;},true);
